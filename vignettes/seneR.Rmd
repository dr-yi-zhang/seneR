---
title: "seneR Workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{seneR Workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 6,
  fig.height = 4
)
```

# Overview

**seneR** is an open-source R package for assessing senescence levels from bulk and single-cell RNA-seq data.  
It provides:

- Senescence scoring (SID score)  
- Phenotype scoring via GSVA  
- Seurat integration for scRNA-seq  
- Trajectory inference  
- Visualization utilities  

seneR wraps the original **SenCID** pretrained model and reproduces its predictions in R.

---

# Installation

```{r eval=FALSE}
# install.packages("devtools")
devtools::install_github("dr-yi-zhang/seneR")
```

Load the package:

```{r}
library(seneR)
# env_Load() 
```

---

# Bulk RNA-seq Example

## Load example data

```{r}
example_expr <- read.csv(
  system.file("demo", "GSE246425_counts.csv", package = "seneR"),
  row.names = 1
)
example_expr[1:4,1:4]

example_meta <- read.csv(
  system.file("demo", "GSE246425_meta.csv", package = "seneR"),
  row.names = 1
)
head(example_meta)
```

---

# Senescence Level (SID Score)

```{r}
SID_res <- SenCID(example_expr)
score_res <- SID_res$score_res
head(score_res)
```

## Group Comparison

```{r}
plot_group(
  score_res,
  example_meta,
  group_col = "group",
  score_col = "SID_Score",
  comparisons = list(c("Old", "Young"))
)
```

---

# Senescence-related Phenotype Assessment

```{r}
gsva_res <- seneGSVA(example_expr)
```

## Violin Plot

```{r}
plot_violin(
  gsva_res,
  example_meta,
  group_col = "group",
  adjust_fdr = TRUE,
  p_threshold = 0.05
)
```

---

# scRNA-seq Example with Seurat

## Load example Seurat object

```{r message=FALSE, warning=FALSE}
library(Seurat)
library(SeuratData)

options(timeout = 600)
SeuratData::InstallData("pbmc3k")
pbmc3k <- LoadData("pbmc3k", type = "pbmc3k.final")
```

## Compute SID score per cell

```{r}
expr_matrix <- GetAssayData(pbmc3k, layer = "counts")
SID_res <- SenCID(expr_matrix, binarize = TRUE)

pbmc3k@meta.data <- cbind(pbmc3k@meta.data, SID_res$score_res)
```

---

# Visualization of Senescence in scRNA-seq

```{r}
VlnPlot(pbmc3k, features = "SID_Score", group.by = "seurat_annotations")
DimPlot(pbmc3k)
DimPlot(pbmc3k, group.by = "RecSID")
DimPlot(pbmc3k, group.by = "Binarization")
FeaturePlot(pbmc3k, features = "SID_Score")
```

---

# Senescence Trajectory Analysis

```{r message=FALSE, warning=FALSE}
library(monocle)
seneCDS <- sene_traject(pbmc3k, color = "SID_Score", cores = 7)
seneCDS <- sene_traject(pbmc3k, color = "seurat_annotations", cores = 7)
```

---

# Trajectory Heatmap

```{r message=FALSE, warning=FALSE}
sene_heatmap(seneCDS, num = 20, num_clusters = 3)
```

---

# Feedback

For questions or comments, please contact:  
**2211563@tongji.edu.cn**

# Contributing

Contributions are welcome via GitHub pull requests and issues.

# References

Tao et al. (2024). SenCID: A predictive model for cellular senescence.

